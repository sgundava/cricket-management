# Cricket Match Engine Probability Parameters
# Calibrated from IPL historical data (278K balls, 1169 matches, 2009-2025)
#
# These parameters can be A/B tested and tuned without code changes.
# All probabilities should sum to 1.0 within their group.
#
# Last updated: Dec 2024 - Full IPL data calibration

# ============================================
# BASE OUTCOME PROBABILITIES
# ============================================
# Calibrated from IPL data (278K balls, 1169 matches, 2009-2025)
# Wicket at 5.14% = ~6 wickets per 120 balls (realistic T20)
base_outcomes:
  dot: 0.326
  single: 0.382
  two: 0.065
  three: 0.003
  four: 0.119
  six: 0.053
  wicket: 0.051

# ============================================
# PHASE MODIFIERS
# ============================================
# Calibrated from IPL data - multipliers applied based on match phase
phase_modifiers:
  powerplay:
    boundary_mod: 1.08    # Slight boundary boost
    wicket_mod: 0.76      # Batters play safer in PP (surprising finding!)
    dot_mod: 1.32         # More defensive play
    run_rate_target: 7.5  # Expected run rate
  middle:
    boundary_mod: 0.85    # Consolidation phase
    wicket_mod: 0.89      # Safer batting
    dot_mod: 0.87
    run_rate_target: 7.8
  death:
    boundary_mod: 1.23    # Big hitting phase
    wicket_mod: 1.78      # High risk swings - nearly 2x wicket rate!
    dot_mod: 0.68
    run_rate_target: 9.8

# ============================================
# TACTICAL APPROACH MODIFIERS
# ============================================
# Based on batting team's tactical approach selection
tactical_modifiers:
  aggressive:
    boundary_mod: 1.25
    wicket_mod: 1.10
    dot_mod: 0.85
  balanced:
    boundary_mod: 1.00
    wicket_mod: 1.00
    dot_mod: 1.00
  cautious:
    boundary_mod: 0.75
    wicket_mod: 0.90
    dot_mod: 1.15

# ============================================
# BOWLING LENGTH MODIFIERS
# ============================================
# Based on bowler's selected length
bowling_length_modifiers:
  good-length:
    boundary_mod: 1.00
    wicket_mod: 1.00
    dot_mod: 1.00
    skill_type: accuracy
    min_skill: 0
  short:
    boundary_mod: 1.30    # Can be pulled/hooked
    wicket_mod: 1.08      # Top edge catches
    dot_mod: 0.85
    skill_type: speed
    min_skill: 65
  yorkers:
    boundary_mod: 0.70    # Hard to hit boundaries
    wicket_mod: 1.05      # LBW, bowled
    dot_mod: 1.30         # Many dots
    skill_type: accuracy
    min_skill: 70         # Need skill to execute
  full-pitched:
    boundary_mod: 1.15    # Driving options
    wicket_mod: 1.10      # Can get driven in air
    dot_mod: 0.95
    skill_type: accuracy
    min_skill: 50

# ============================================
# FIELD SETTING MODIFIERS
# ============================================
# Based on bowling team's field setting
field_setting_modifiers:
  attacking:
    boundary_mod: 1.25    # Gaps in outfield
    wicket_mod: 1.10      # More catching positions
    catch_mod: 1.15
    runout_mod: 0.90
  balanced:
    boundary_mod: 1.00
    wicket_mod: 1.00
    catch_mod: 1.00
    runout_mod: 1.00
  defensive:
    boundary_mod: 0.70    # Boundary riders
    wicket_mod: 0.90      # Fewer catchers
    catch_mod: 0.85
    runout_mod: 1.10
  death-field:
    boundary_mod: 0.60    # Long-off, long-on, deep
    wicket_mod: 0.95
    catch_mod: 1.05       # High catches
    runout_mod: 1.15

# ============================================
# BATSMAN STATE MODIFIERS
# ============================================
# Calibrated from IPL data - based on balls faced by the batter
batsman_state:
  thresholds:
    new: 6          # First 6 balls
    settling: 15    # Balls 7-15
  modifiers:
    new:
      boundary_mod: 0.78    # Getting eye in
      wicket_mod: 0.90      # Actually SAFER - playing carefully
      dot_mod: 1.30         # Many more dots
      single_mod: 0.88
    settling:
      boundary_mod: 1.12    # Opening up
      wicket_mod: 1.01
      dot_mod: 0.97
      single_mod: 0.98
    set:
      boundary_mod: 1.11    # Full confidence
      wicket_mod: 1.08      # Taking more risks
      dot_mod: 0.74         # Fewer dots
      single_mod: 1.13      # Better rotation

# ============================================
# PRESSURE/MOMENTUM MODIFIERS
# ============================================
# DATA-DERIVED from IPL analysis - these values are crucial for realistic match flow
pressure:
  # Recent wickets in last 3 overs - KEY FOR COLLAPSE PREVENTION
  # After 3+ wickets, pressure compounds (dampened from raw IPL data to prevent excessive cascading)
  recent_wickets:
    0:
      boundary_mod: 1.058   # Batters attack freely when stable
      wicket_mod: 0.958
      dot_mod: 1.008
    1:
      boundary_mod: 0.935   # Slight caution
      wicket_mod: 1.026
      dot_mod: 0.967
    2:
      boundary_mod: 0.834   # Significant consolidation
      wicket_mod: 1.12      # 12% more wicket risk (dampened from 16%)
      dot_mod: 1.054
    3:
      boundary_mod: 0.738   # Full survival mode
      wicket_mod: 1.38      # 38% more wicket risk (dampened from 54% to prevent cascading)
      dot_mod: 1.096

  # Bowler psychological advantage
  # Note: Current data shows limited granularity, using conservative estimates
  bowler_on_roll:
    2_wickets:
      boundary_mod: 0.96
      wicket_mod: 1.05
    3_wickets:
      boundary_mod: 0.92
      wicket_mod: 1.10

  # Partnership dynamics - DATA-DERIVED
  # Key insight: early partnerships are SAFEST, then risk increases as batters attack
  partnership:
    "0_10":
      boundary_mod: 0.816   # Conservative start
      wicket_mod: 0.925     # Safest period!
      dot_mod: 1.202
    "10_20":
      boundary_mod: 1.071   # Opening up
      wicket_mod: 1.017
      dot_mod: 0.957
    "20_30":
      boundary_mod: 1.130   # Building momentum
      wicket_mod: 1.037
      dot_mod: 0.870
    "30_50":
      boundary_mod: 1.188   # Attacking freely
      wicket_mod: 1.056
      dot_mod: 0.811
    "50_75":
      boundary_mod: 1.143   # Established
      wicket_mod: 1.111     # Taking more risks
      dot_mod: 0.732
    "75_100":
      boundary_mod: 1.210   # Dominant
      wicket_mod: 1.178
      dot_mod: 0.624
    "100_plus":
      boundary_mod: 1.424   # Carnage mode
      wicket_mod: 1.233
      dot_mod: 0.572

  # High required rate forces risks - DATA-DERIVED from 2nd innings analysis
  required_rate:
    low:          # RRR <= 6
      boundary_mod: 1.10
      wicket_mod: 0.77
    normal:       # RRR 6-9
      boundary_mod: 0.99
      wicket_mod: 0.76
    9_to_12:
      boundary_mod: 0.95
      wicket_mod: 0.97
    over_12:
      boundary_mod: 0.94    # Surprisingly, boundaries don't increase much
      wicket_mod: 1.62      # But wickets skyrocket!

# ============================================
# MOMENTUM MODIFIERS (NEW - DATA-DERIVED)
# ============================================
# Boundaries come in bursts, dot balls build pressure
momentum:
  # Impact of runs scored in last 6 balls (1 over)
  by_recent_runs:
    "0_2":
      boundary_mod: 0.819   # Low momentum
      wicket_mod: 0.831     # Also safer though
    "3_7":
      boundary_mod: 0.911   # Normal flow
      wicket_mod: 0.959
    "8_14":
      boundary_mod: 1.080   # Building momentum
      wicket_mod: 1.049
    "15_24":
      boundary_mod: 1.345   # Hot streak - 35% more boundaries!
      wicket_mod: 1.227

  # Boundary bursts - boundaries breed boundaries
  by_recent_boundaries:
    "0":
      boundary_mod: 0.858   # Cold
      wicket_mod: 0.947
    "1":
      boundary_mod: 1.001   # Neutral
      wicket_mod: 1.018
    "2":
      boundary_mod: 1.143   # Warming up
      wicket_mod: 1.018
    "3_plus":
      boundary_mod: 1.334   # On fire - 33% more boundaries!
      wicket_mod: 1.128

  # Dot ball pressure - consecutive dots make batters nervous
  by_recent_dots:
    "0":
      boundary_mod: 1.080   # Flowing
      wicket_mod: 1.078
    "1":
      boundary_mod: 1.068
      wicket_mod: 1.069
    "2":
      boundary_mod: 1.016   # Starting to feel pressure
      wicket_mod: 1.005
    "3":
      boundary_mod: 0.950
      wicket_mod: 0.971
    "4":
      boundary_mod: 0.917   # Mounting pressure
      wicket_mod: 0.894     # But actually safer - playing careful
    "5_plus":
      boundary_mod: 0.865   # Strangled
      wicket_mod: 0.889

# ============================================
# SPELL PATTERNS (NEW - DATA-DERIVED)
# ============================================
# For AI bowler selection - when different bowler types should bowl
spell_patterns:
  # Pace bowlers dominate PP and death
  pace_profile:
    powerplay: 0.495      # ~50% of pace overs in PP
    middle: 0.274         # Limited middle overs use
    death: 0.231          # Key death overs role

  # Spin bowlers dominate middle overs
  spin_profile:
    powerplay: 0.228      # Occasional PP use
    middle: 0.659         # ~66% of spin overs in middle
    death: 0.113          # Rarely at death

  # Consecutive overs patterns
  consecutive_overs:
    typical_max: 2        # Most bowlers bowl max 2 consecutive
    recommended_rest: 2   # Overs between spells

# ============================================
# WICKET CLUSTERING REFERENCE
# ============================================
# For understanding collapse patterns - 52% of innings have a collapse!
wicket_clustering:
  mean_gap_balls: 16.3          # Average balls between wickets
  median_gap_balls: 12.0        # Median gap (lower = clustering)
  clustering_ratio: 1.20        # Wickets come 20% closer than random
  collapse_rate: 0.52           # 52% of innings have 3+ wickets in 3 overs
  # Gap by wicket number - later wickets cluster more
  gap_by_wicket:
    2: 22.0   # 2nd wicket comes ~22 balls after 1st
    3: 20.6
    4: 18.1
    5: 15.3
    6: 12.2
    7: 9.4    # 7th wicket just 9 balls after 6th - collapse territory

# ============================================
# SKILL IMPACT
# ============================================
# How player skills affect outcomes
# Values are per 10 skill points above 60 baseline
skill_impact:
  batting:
    technique:
      boundary: 0.02
      wicket: -0.01
    power:
      six: 0.03
      four: 0.01
    timing:
      four: 0.02
      single: 0.01
    temperament:
      wicket: -0.02

  bowling:
    speed:
      wicket: 0.015
      boundary: 0.01      # Pace is double-edged
    accuracy:
      dot: 0.02
      wicket: 0.01
      boundary: -0.02
    variation:
      wicket: 0.02
      boundary: -0.01
    stamina:
      fatigue_resistance: 0.02

# ============================================
# PITCH EFFECTS
# ============================================
# Per 10 points above 50 baseline
pitch:
  pace:
    fast_bowler_wicket: 0.02
    boundary: 0.01
  spin:
    spin_bowler_wicket: 0.02
    boundary: -0.01
  bounce:
    wicket_from_short: 0.015
  deterioration:
    second_innings_spin: 0.03

# ============================================
# DISMISSAL TYPE DISTRIBUTION
# ============================================
# Calibrated from IPL data - caught dominates at 65%!
dismissals:
  base:
    caught: 0.65
    bowled: 0.17
    lbw: 0.06
    runout: 0.08
    stumped: 0.03
    hitwicket: 0.01

  # Adjustments by bowler type
  fast_bowler:
    caught: 0.68
    bowled: 0.18
    lbw: 0.08
    runout: 0.05
    stumped: 0.00
    hitwicket: 0.01

  spin_bowler:
    caught: 0.60
    bowled: 0.14
    lbw: 0.05
    runout: 0.06
    stumped: 0.14
    hitwicket: 0.01

# ============================================
# FIELDING IMPACT
# ============================================
fielding:
  baseline: 60    # Average skill level
  boundary_save:
    max_chance: 0.30    # Maximum save probability
    athleticism_weight: 0.7
    ground_weight: 0.3
  catch_conversion:
    baseline: 0.85    # 85% catch success
    skill_impact: 0.002    # Per point above baseline
  runout:
    baseline: 0.70
    throwing_impact: 0.003

# ============================================
# EXTRAS
# ============================================
# Calibrated from IPL data
extras:
  wide_chance: 0.0326     # Per ball (3.26% - higher than expected)
  noball_chance: 0.0041   # Per ball (0.41% - lower than expected)
  accuracy_impact: -0.0002    # Per accuracy point
